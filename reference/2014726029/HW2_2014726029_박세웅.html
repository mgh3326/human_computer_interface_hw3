<html>
	<head>
		<title>My Calculator</title>
		
		<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet"> 
		<style type="text/css">
		body {
			margin: 0px 0px 0px 0px;
		}
		
		#calculator {
            width: 342px;
            background-color: #fbfbfb;
            padding: 30px;
            margin: auto;
            border-radius: 20px;   
			border: 10px solid black;
			box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);			
        }
		
		#result {
            width: 330px;
            height: 60px;
			margin-top: 0px;
            margin-bottom: 15px;
            padding: 0px 5px 0px 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: inline-flex;
            justify-content: flex-end;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0px 5px;
            font: 20px digital;
        }
		
		#history {
            width: 300px;
            height: 50px;
            margin-top: 0px;
            margin-bottom: 10px;
            padding: 0px 5px 0px 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: inline-flex;
            justify-content: flex-end;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0px 5px;
            font: 15px digital;       
			scroll: true;
        }
		
		.key {
            width: 35px;
            height: 25px;
            background-color: #ececec;
            display: inline-flex;
            margin: 3px 5px 8px 0px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 5px 0px 5px 0px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 20px sans-serif;
			border: 2px solid black;
        }
		
		.variable-key {
            font: bold italic 20px "Times New Roman";
			background-color: skyblue;
        }
		
		.const-key {
            font: bold italic 20px "Times New Roman";
			background-color: #7b99cb;
        }
		
        .define-key {
            font: bold italic 20px "Times New Roman";
        }
		
		.operator-key {
			background-color: #FACC2E
		}

        .function-key {
            font: bold italic 15px "Times New Roman";
			background-color: #A4A4A4;
        }

        .eval-key {
            background-color: #4a9840;
            color: white;
        }
		
		.compare-key {
            background-color: #F6CED8;
            color: white;
        }
		
		.backspace-key {
			background-color: #bacca6;	
			color: white;
			
		}
        .clear-key {
            background-color: #bb1c09;
            color: white;
        }
		
		.clear-memory-key {
            background-color: #bb1c09;
            color: white;
        }
		
        .key:active {
            background-color: #a1a1a1;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
        }
	</style>	
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js' type='text/javascript'></script>
    <script src='math.js' type='text/javascript'></script>

    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>  
	
	<script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          "HTML-CSS": { scale: 75}
        });
    </script>
	
    <script type="text/javascript">
		$(document).ready(function(){
			var parser = math.parser();
			var num = 0;
			var displayValue = '0';
			
			function pushToMemory (num, value) {
				var node = math.parse(value);
				var history = node.toTex({parenthesis: 'keep', implicit: 'hide'});
				var elem = MathJax.Hub.getAllJax('history')[num];
				MathJax.Hub.Queue(['Text', elem, history]);
				
			}
			
			$('#result').text(displayValue);
			$('#history').html('$$' + math.parse(displayValue).toTex() + '$$');
            $('.key').each(function(index, key){       
                $(this).click(function(e){
                    if(displayValue == '0') displayValue = '';

                    if($(this).text() == 'EV')
                    {
					    try
                        {
							displayValue = parser.eval(displayValue).toString();
                            var tokens = displayValue.split(' ');
                            if(tokens[0] == 'function')
                            {
                                displayValue = tokens[0];
                            }
						
							$('#result').text(displayValue);                         
                            displayValue = '0';
                        }
                        catch (e)
                        {
                            displayValue = '0';
                            if(displayValue != 'function')
                            {
                                $('#result').text(e);
                            }
                        }               
                    }
					else if ($(this).text() == 'BS')
					{
						var resultValue = $('#result').text();
						if (resultValue === '') return;
						var newResultValue = resultValue.substring(0, resultValue.length - 1);
						displayValue = newResultValue;
						$('#result').text(newResultValue);
					}
					
                    else
                    {
                        if ($(this).text() == 'CL') 
						{
							displayValue = '0';
							$('#result').text(displayValue);
						} else 
						{
							if ($(this).text() == 'CM') 
							{
								displayValue = '0';
								$('#result').text(displayValue);
								
								num = 0;
							}
							
							else 
							{
								displayValue += $(this).text();
								$('#result').text(displayValue);
							}
    
							pushToMemory(num, displayValue);
						}
                    }

                    e.preventDefault()
                })
            })
        })
    </script>
	</head>
	<body>
				
		<div id="calculator">
			<h3><span style="font-family:Great Vibes;">My Calculator by Se Woong Park</span></h3>
			<div id="history"></div>
			<div id="result"></div>
			
			<span class="key clear-key">CL</span>
			<span style="margin-right:200px" class="key clear-memory-key">CM</span>
			<span class="key backspace-key">BS</span>
			<span class="key define-key">f</span>
			<span class="key define-key">g</span>
			<span class="key">(</span>
			<span class="key">)</span>
			<span class="key">[</span>
			<span class="key">]</span>
			<span class="key">;</span>
			
			<span class="key function-key">det</span>
			<span class="key function-key">inv</span>
			<span class="key function-key">!</span>
			<span class="key function-key">cross</span>
			<span class="key const-key">e</span>
			<span class="key const-key">i</span>
			<span class="key const-key">pi</span>
			
			<span class="key function-key">sin</span>
			<span class="key function-key">cos</span>
			<span class="key function-key">tan</span>
			<span class="key function-key">exp</span>
			<span class="key function-key">log</span>
			<span class="key function-key">sqrt</span>
			<span class="key function-key">^</span>
			
			<span class="key compare-key">==</span>
			<span class="key compare-key">!=</span>
			<span class="key">7</span>
			<span class="key">8</span>
			<span class="key">9</span>
			<span class="key">.</span>
			<span class="key">,</span>
			
			
			<span class="key compare-key">></span>
			<span class="key compare-key"><</span>
			<span class="key">4</span>
			<span class="key">5</span>
			<span class="key">6</span>
			<span class="key operator-key">+</span>
			<span class="key operator-key">-</span>
			
			<span class="key compare-key">>=</span>
			<span class="key compare-key"><=</span>
			<span class="key">1</span>
			<span class="key">2</span>
			<span class="key">3</span>
			<span class="key operator-key">*</span>
			<span class="key operator-key">/</span>
			
			<span class="key variable-key">x</span>
			<span class="key variable-key">y</span>
			<span class="key variable-key">z</span>
			<span class="key">0</span>
			<span class="key">=</span>
			<span class="key operator-key">%</span>
			<span class="key eval-key">EV</span>
		</div>
	</body>
</html>