<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>calculater</title>
	<style type ="text/css">
		body {
            margin: 0px 0px 0px 0px;
        }
		#calculator {
            font-size: 0;
            width: 200px;
            background-color: #B3CAEC;
            padding: 10px;
            margin: auto;
            border-radius: 5px;
        }
		#display {
            width: 192.5px;
            height: 60px;
            margin-bottom: 0px;
            padding: 0px 2.5px 0px 2.5px;
            background-color: #F3F3F3;
            border-top-left-radius: 5px;
			border-top-right-radius: 5px;
            display: inline-flex;
            justify-content: flex-end;
            
            overflow: hidden;
            box-shadow: inset 0 0px 3px;
            font: 15px digital;
        }
		#input{
			width: 187px;
			height: 40px;
			margin-bottom: 15px;
            padding: 0px 5px 0px 5px;
            background-color: #F3F3F3;
            border-bottom-left-radius: 10px;
			border-bottom-right-radius: 10px;
            display: inline-flex;
            justify-content: flex-end;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0px 3px;
            font: 10px digital;
		}
		.funckey {
            width: 46px;
            height: 7.5px;
            background-color: #eeeeee;
            display: inline-flex;
            margin: 1.5px 4px 5px 0px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 2.5px 0px 2.5px 0px;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 10px sans-serif;
        }
		.numkey {
            width: 59px;
            height: 10px;
            background-color: #eeeeee;
            display: inline-flex;
            margin: 1.5px 7.5px 5px 0px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 2.5px 0px 2.5px 0px;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 10px sans-serif;
        }
		.nomalkey {
            width: 46px;
            height: 7.5px;
            background-color: #eeeeee;
            display: inline-flex;
            margin: 1.5px 4px 5px 0px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 2.5px 0px 2.5px 0px;
            border-radius: 2px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 10px sans-serif;
        }
		.specialkey{
			width: 46px;
            height: 7.5px;
            background-color: #eeeeee;
            display: inline-flex;
            margin: 1.5px 54px 5px 0px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 2.5px 0px 2.5px 0px;
            border-radius: 2px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 10px sans-serif;
		}
		.save{
			width: 35.5px;
		}
		.halfkey{
			width: 21.5px;
            height: 7.5px;
            background-color: #eeeeee;
            display: inline-flex;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 2.5px 0px 2.5px 0px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 3px rgba(0, 0, 0, .75);
            font: bold 10px sans-serif;
		}
		.halfkey.left{
			margin : 1.5px 0.5px 5px 0px;
			border-top-left-radius: 2px;
			border-bottom-left-radius:  2px;
				
		}
		.halfkey.right{
			margin : 1.5px 6.5px 5px 0px;
			border-top-right-radius: 2px;
			border-bottom-right-radius:  2px;
		}
		.key:active{
			background-color: #a1a1a1;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
		}
		.specialkey:active{
			background-color: #a1a1a1;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
		}
		#matrixhelper {
			width: 134px;
			height: 134px;
			position: fixed;
			top: 100px;
			left: 410px;
			display: block;
			border: 1px solid #808080;
			background-color: #fff;
			padding: 5px;
			text-align: center;
			border-radius: 5px;
			display: none;
			z-index: 12354;
		}
		
		#matrixhelper span{display:inline-block;width:20px;height:20px;background-color:#f0f0f0;margin:2px;float:left}
		#matrixhelper span.m{background-color:#f0f0ff}
		#matrixhelper span.v{background-color:#f0fff0}
		#matrixhelper span.hover{background-color:#c0c0c0}
		#matrixhelper span.m.hover{background-color:#c0c0cc}
		#matrixhelper span.v.hover{background-color:#c0ccc0}
		
	</style>
	<script src='./jsfile/math.js' type='text/javascript'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js' type='text/javascript'></script>
	
	<script type="text/javascript">
		
		$.fn.selectRange = function(start, end) {

    return this.each(function() {

         if(this.setSelectionRange) {

             this.focus();

             this.setSelectionRange(start, end);

         } else if(this.createTextRange) {

             var range = this.createTextRange();

             range.collapse(true);

             range.moveEnd('character', end);

             range.moveStart('character', start);

             range.select();

         }

     });

 };
		
		$.fn.getCursorPosition = function() {
        var input = this.get(0);
        if (!input) return; // No (input) element found
        if (document.selection) {
            // IE
           input.focus();
        }
        return 'selectionStart' in input ? input.selectionStart:'' || Math.abs(document.selection.createRange().moveStart('character', -input.value.length));
     };
		
		
		
		
	
	
        $(document).ready(function () {

 
            
            var parser = math.parser();
			var changed = 0;
			var mode = 0;
			var cmpMode = 0;
			
            var displayValue = '0';
            $('#display').attr('value',displayValue);
			$('#input').attr('value',displayValue);
 			$('#input').selectRange(1,1);
			
            $('.key').each(function(index, key){       
                $(this).click(function(e){
                    if(displayValue == '0') displayValue = '';

                    if($(this).attr('id') == 'enter')
                    {
						displayValue = $('#input').attr('value');
                        try
                        {
                            displayValue = parser.eval(displayValue).toString();
                            var tokens = displayValue.split(' ');
                            if(tokens[0] == 'function')
                            {
                                displayValue = tokens[0];
                            }
                            $('#display').attr('value',displayValue);                         
                            displayValue = '0';
							$('#input').attr('value',displayValue);
                        }
                        catch (e)
                        {
                            displayValue = '0';
                            if(displayValue != 'function')
                            {
                                $('#display').attr('value',e);
                            }
                        }               
                    }
                    else
                    {
                        if($(this).attr('id') == 'AC')
                        {
                            displayValue = '0';
                            $('#input').attr('value',displayValue);
							$('#display').attr('value',displayValue);
                        }
						else if($(this).attr('id') == 'DEL')
							{
								var textdelete = $('#input').attr('value');
								var nowcur = $('#input').getCursorPosition();
								
								if(nowcur<2)
									{
										$('#input').attr('value',textdelete.substring(nowcur));
									}
								else
									{
										$('#input').attr('value',textdelete.substring(0,nowcur-1) + textdelete.substring(nowcur));
									}
								
								
								displayValue = $('#input').attr('value');
							}
						else if($(this).attr('id') == "ans")
							{
								displayValue += $('#display').attr('value');
								$('#input').attr('value',displayValue);
								$('#input').selectRange(displayValue.length,displayValue.length);
								$('#display').attr('value','0');
							}
						else if($(this).attr('id') == "shift")
							{
								var changeListA =["sin","cos","tan","cross","dot"];
								var changeListB =["asin","acos","atan","inv","multiply"];
								if(changed == 0)
									{
										changed = 1;
										
										for(var i =0; i<changeListA.length ; i++)
											{	
												if(changeListB[i] == "inv")
													$('#'+changeListA[i]).text("역행렬");
												else if(changeListB[i] == "multiply")
													$('#'+changeListA[i]).text("행렬곱");
												else
													$('#'+changeListA[i]).text(changeListB[i]);
												
												$('#'+changeListA[i]).prop('id',changeListB[i]);
											}
									}
								else
									{
										changed = 0;
										for(var i =0; i<changeListA.length ; i++)
											{
												if(changeListA[i] == "cross")
													$('#'+changeListB[i]).text("외적");
												else if(changeListA[i] == "dot")
													$('#'+changeListB[i]).text("내적");
												else
													$('#'+changeListB[i]).text(changeListA[i]);
												$('#'+changeListB[i]).prop('id',changeListA[i]);
											}
									}
							}
						else if($(this).attr('id') == "mode")
							{
									    var changeListA =["1","2"];
										var changeListB =["벡터","행렬"];
										if(mode == 0)
										{
											mode = 1;

											for(var i =0; i<changeListA.length ; i++)
												{
													$('#'+changeListA[i]).text(changeListB[i]);
													$('#'+changeListA[i]).prop('id',changeListB[i]);
												}
										}
										else
										{
											mode = 0;
											for(var i =0; i<changeListA.length ; i++)
											{
												$('#'+changeListB[i]).text(changeListA[i]);
												$('#'+changeListB[i]).prop('id',changeListA[i]);
											}
										}
										if(cmpMode == 1)
										{
											var changeListC =["sin","cos","tan","ans"];
											var changeListD =["<",">","=","!"];
											cmpMode=0;
											for(var i =0; i<changeListC.length ; i++)
											{
												$('#'+changeListD[i]).text(changeListC[i]);
												$('#'+changeListD[i]).prop('id',changeListC[i]);
											}
										}
							}
						else if($(this).attr('id') == "벡터")
							{
								var changeListA =["1","2"];
								var changeListB =["벡터","행렬"];
								mode = 0;
								for(var i =0; i<changeListA.length ; i++)
								{
									$('#'+changeListB[i]).text(changeListA[i]);
									$('#'+changeListB[i]).prop('id',changeListA[i]);
								}
								if($('#input').attr('value') != 0)
									$('#input').attr('value',  $('#input').attr('value') + "[ , , ]");
								else
									$('#input').attr('value', "[ , , ]");
							}
						else if($(this).attr('id') == "행렬")
							{
								
								var btnmatrix = $("#행렬");
			
								var left = btnmatrix.offset().left;
								var top = btnmatrix.offset().top;

								var matrixhelper = $("#matrixhelper");
								if (!matrixhelper.hasClass("loaded")) {
									matrixhelper.addClass("loaded");
									
									matrixhelper.mouseup(function(){
										matrixhelper.hide();
										if($('#input').attr('value') != '0')
											$('#input').attr('value', $('#input').attr('value')+matrixhelper.data("input"));
										else
											$('#input').attr('value', matrixhelper.data("input"));
										var changeListA =["1","2"];
										var changeListB =["벡터","행렬"];
										mode = 0;
										for(var i =0; i<changeListA.length ; i++)
										{
											$('#'+changeListB[i]).text(changeListA[i]);
											$('#'+changeListB[i]).prop('id',changeListA[i]);
										}
									
									});

									matrixhelper.mousemove(function(e){
										
										matrixhelper.find("span").removeClass("hover");
										var x = (e.pageX - btnmatrix.offset().left)/24;
										var y = (e.pageY - btnmatrix.offset().top)/24;
										if (x<1)x=1;
										if (y<1)y=1;
										if (x>5)x=5;
										if (y>5)y=5;

										var divs = matrixhelper.find("div");
										for (var i=0;i<y;i++) {
											var div = divs.eq(i);
											var spans = div.find("span");
											for (var j=0;j<x;j++) {
												spans.eq(j).addClass("hover");
											}
										}

										var matrix = "";
										if (x==1) {
											for (var i=0;i<y;i++)
												matrix+="0, ";

											matrix = "("+matrix.slice(0,-2)+")";
										} else {
											for (var j=0;j<y;j++) {
												var row = "";
												for (var i=0;i<x;i++)
													row+="0, ";

												matrix += "["+row.slice(0,-2)+"],";
											}
											matrix = "["+matrix.slice(0,-1)+"]";
										}
										matrixhelper.data("input", matrix);
									});
								}

								matrixhelper.css({"left":(left+"px"), "top":(top+"px")});
								matrixhelper.show();
								
							}
						
						else if($(this).attr('id') == "BtnLeft")
							{
								
							}
                        else
                        {                        
							var textdelete = $('#input').attr('value');
							var nowcur = $('#input').getCursorPosition();
							
							if($('#input').attr('value') == '0')
								$('#input').attr('value',$(this).attr('id'));
							else
								$('#input').attr('value',textdelete.substring(0,nowcur)+ $(this).attr('id') + textdelete.substring(nowcur));
							
							
                            displayValue = $('#input').attr('value');
                        }
                    }
					
					if($(this).attr('id') == 'BtnLeft') //커서 옮기기 버튼 구현!
						{
							if($('#BtnLeft').text() == "▶")
								{
									var input = $('#input');
									var nowcur = input.getCursorPosition();
									
									if(nowcur < input.attr('value').length)
										input.selectRange(nowcur+1 , nowcur+1);
									else
										input.selectRange(nowcur,nowcur);
								}
							else if($('#BtnLeft').text() == "◀")
								{
									var input = $('#input');
									var nowcur = input.getCursorPosition();
									
									if(nowcur > 0)
										input.selectRange(nowcur-1 , nowcur-1);
									else
										input.selectRange(nowcur,nowcur);
								}
						}
					else if($(this).attr('id') == 'DEL')
						{
							var nowcur = $('#input').getCursorPosition();
							if(nowcur == 0)
								$('#input').selectRange(0,0);
							else
								$('#input').selectRange(nowcur-1,nowcur-1);
						}
					else if($(this).attr('id') == "벡터")
						{
							var lastpos = $('#input').length;
							$('#input').selectRange(lastpos - 5,lastpos - 5);
						}
					else
						{
							var nowcur = $('#input').getCursorPosition();
							$('#input').selectRange(nowcur+$(this).attr('id').length,nowcur+$(this).attr('id').length);
						}
					
					
					
                    e.preventDefault();
                })
            })
			
			$('#BtnLeft').mousemove(function (event){
				var btnleft = $("#BtnLeft");
				if ((event.pageX-btnleft.offset().left)>btnleft.width()/2)
				{
				btnleft.text("▶");
				} 
				else
				{
				btnleft.text("◀");
				}
			
				btnleft.mouseout(function(){
					btnleft.text("커서");
				})
			})
		})

				
    </script>
	
</head>
<body>
	<h1> CALCULATOR VERSION 1</h1>
	
	<div id = "calculator">
		<input type="text" id="display" readonly></input>
		<input type="text" id="input" ></input>
		<tr align="center">
			<span class="key specialkey" id="shift">shift</span>
			<span class="key specialkey" id="mode">mode</span>
		</tr>
		
		<span class="key funckey need" id="log">log</span>
		<span class="key funckey" id="^">x^y</span>
		<span class="key funckey need" id="sqrt">√</span>
		<span class="key funckey" id="AC">AC</span>
		<span class="key funckey" id="log(e,">ln</span>
		<span class="key funckey" id="e^">e^x</span>
		<span class="key funckey" id="%">%</span>
		<span class="key funckey" id="BtnLeft">커서</span>
		<span class="key  halfkey left" id="(">(</span>
		<span class="key  halfkey right" id=")">)</span>
		<span class="key  halfkey left" id="[">[</span>
		<span class="key  halfkey right" id="]">]</span>
		<span class="key funckey" id="e">e</span>
		<span class="key funckey" id="pi">π</span>
		<span class="key funckey need" id="sin">sin</span>
		<span class="key funckey need" id="cos">cos</span>
		<span class="key funckey need" id="tan">tan</span>
		<span class="key funckey" id="ans">Ans</span>
	
		<span class="key funckey" id=":">:</span>
		<span class="key funckey" id=";">;</span>
		<span class="key funckey" id=",">,</span>
		<span class="key funckey" id="i">i</span>

		<span class="key funckey save" id="x">x</span>
		<span class="key funckey save" id="y">y</span>
		<span class="key funckey save" id="z">z</span>
		<span class="key funckey save" id="f">f(x)</span>
		<span class="key funckey save" id="g">g(x)</span>
	
		<span class="key funckey" id="cross">외적</span>
		<span class="key funckey" id="dot">내적</span>
		<span class="key specialkey" id="det">행렬식</span>
		
	
		<span class="key  halfkey left" id="+">+</span>
		<span class="key  halfkey right" id="-">-</span>
		<span class="key  halfkey left" id="*">*</span>
		<span class="key  halfkey right" id="/">/</span>
		<span class="key  halfkey left" id="<"><</span>
		<span class="key  halfkey right" id=">">></span>
		<span class="key  halfkey left" id="=">=</span></span>
		<span class="key  halfkey right" id="!">!</span>
	
		<span class="key numkey" id="1">1</span>
		<span class="key numkey" id="2">2</span>
		<span class="key numkey" id="3">3</span>
		<span class="key numkey" id="4">4</span>
		<span class="key numkey" id="5">5</span>
		<span class="key numkey" id="6">6</span>
		<span class="key numkey" id="7">7</span>
		<span class="key numkey" id="8">8</span>
		<span class="key numkey" id="9">9</span>
		<span class="key nomalkey" id="DEL">DEL</span>
		<span class="key nomalkey" id="0">0</span>
		<span class="key nomalkey" id=".">.</span>
		<span class="key nomalkey" id="enter">enter</span>
		<div class="" id="matrixhelper" data-input="">
			<div><span class="v m">&nbsp;</span><span class="m">&nbsp;</span><span class="m">&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></div>
			<div><span class="v">&nbsp;</span><span class="m">&nbsp;</span><span class="m">&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></div>
			<div><span class="v">&nbsp;</span><span class="m">&nbsp;</span><span class="m">&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></div>
			<div><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></div>
			<div><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></div>
		</div>
	</div>
</body>
</html>
