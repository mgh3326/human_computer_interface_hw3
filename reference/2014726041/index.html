<!DOCTYPE html>
<html>
    <head>
        <title>My Calculator 2014726041</title>
        <link href="css/index.css" type="text/css" rel="stylesheet" />
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js' type='text/javascript'></script>
        <script src='math.js' type='text/javascript'></script>

        <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>  
        <script src="https://cdn.plot.ly/plotly-1.35.2.min.js"></script>

        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
              "HTML-CSS": { scale: 75}
            });
        </script>
        <script type="text/javascript">
            
        </script>
        <script type="text/javascript">
            $(document).ready(function(){
                
                /**** icons *****/
                $('#ic-save').click(function(){
                    alert("저장되었습니다.");
                })
                $('#ic-new').click(function(){
                    alert("새 파일을 엽니다.")
                })
                $('#ic-open').click(function(){
                    alert("파일을 불러옵니다.")
                })
                
                /**** cal pen *****/
                var canvas, ctx;
                canvas = document.getElementById('pen-panel');
                ctx = canvas.getContext("2d");
                var isDraw = false;

                var dot = 1;
                var color = 'rgb(0,0,0)';
                canvas.onmousemove = function(e){
                    if(isDraw)
                        draw(e);
                }
                canvas.onmousedown = function(e){
                    if(e.button == 0){ // mouse left click
                        isDraw = true;
                        draw(e);
                    } 
                }
                canvas.onmouseup = function(e){
                    isDraw = false;
                }

                function draw(e){
                    ctx.fillStyle = color;
                    ctx.fillRect(e.offsetLeft, e.offsetTop, dot, dot);
                }
                
                
                /**** cal button *****/
                var calstatus = 'None';
                $('#nummode').click(function(){
                    $('#nummode-dropdown').slideToggle();
                    $('#nummode-dropdown>p').click(function(){
                        var txt = $(this).text();
                        $('#nummode').text(txt+" ▼");
                        $('#nummode-dropdown').slideUp();
                    })
                });
                $('#calmode').click(function(){
                    $('#calmode-dropdown').slideToggle();
                    $('#calmode-dropdown>p').click(function(){
                        var txt = $(this).text();
                        $('#calmode').text(txt+" ▼");
                        calstatus = txt;
                        $('#calmode-dropdown').slideUp();
                    })
                });
                $('#tag-pen').click(function(){
                    $('#cal-button').hide();
                    $('#cal-pen').show();
                });
                $('#tag-button').click(function(){
                    $('#cal-button').show();
                    $('#cal-pen').hide();
                });
                var parser = math.parser();
                var displayValue = '0';
                
                var inputArr = new Array();
                var outputArr = new Array();
                $('#input01').text('0');
                var curTable = $('#tableIO');
                $('.button').each(function(index, key){       
                $(this).click(function(e){
                    if(displayValue == '0') displayValue = '';

                    if($(this).text() == 'EQUAL')
                    {
                        if(calstatus == 'None'){
                            try
                            {
                                inputArr.push(displayValue);
                                displayValue = parser.eval(displayValue).toString();
                                var tokens = displayValue.split(' ');
                                if(tokens[0] == 'function')
                                {
                                    displayValue = tokens[0];
                                }
                                $('#output01').text(displayValue);
                                outputArr.push(displayValue);
                                var newTable = document.createElement("table");
                                var newTr = document.createElement("tr");
                                var newInTd = document.createElement("td");
                                var newOutTd = document.createElement("td");
                                var newInBox = document.createElement("div");
                                var newOutBox = document.createElement("div");
                                
                                newTable.className = "tableIO";
                                newInTd.className = "titleIO";
                                newInTd.text = "Input";
                                newOutTd.className = "titleIO";
                                newOutTd.text = "Output";
                                newInBox.className = "textbox";
                                newOutBox.className = "textbox";
                                $('#board-content').append(newTable);
                                newTable.append(newTr);
                                newTr.append(newInTd, newInBox, newOutTd, newOutBox);
                                displayValue = '0';
                            }
                            catch (e)
                            {
                                displayValue = '0';
                                if(displayValue != 'function')
                                {
                                    $('#output01').text(e);
                                }
                            }
                        }
                        else if(calstatus == 'Graph'){
                            drawGraph(displayValue);
                            displayValue = '0';
                        }
                    }
                    else
                    {
                        if($(this).text() == 'AC')
                        {
                            displayValue = '0';
                            $('#input01').text(displayValue);
                            $('#output01').text('');
                            $('#output01').height('');
                        }
                        else if($(this).text() == 'ENTER'){
                            displayValue += '\n';
                            $('#input01').text(displayValue);
                        }
                        else
                        {                        
                            displayValue += $(this).text();
                            $('#input01').text(displayValue);
                        }

                        var node = math.parse(displayValue);
                        var latex = node.toTex({parenthesis: 'keep', implicit: 'hide'});
                        var elem = MathJax.Hub.getAllJax('latex')[0];
                        MathJax.Hub.Queue(['Text', elem, latex]);
                    }

                    e.preventDefault();
                })
            })
            });
            
            function drawGraph(displayValue) {
                try {
                    $("#output01").height('200px');
                    var expression = displayValue;
                    var expr = math.compile(expression);

                    var xValues = math.range(-10, 10, 0.5).toArray();
                    var yValues = xValues.map(function (x) {
                        return expr.eval({x: x});
                    });

                    var trace1 = {
                        x: xValues, y: yValues, type: 'scatter', mode: "lines"
                    };
                    var data = [trace1];
                    
                    Plotly.newPlot('output01', data);
                }
                catch (e) {
                    $('#output01').text(e);
                }
            }
        </script>
    </head>
    <body>
        <div id="header">
            Welcome to My Calculator
        </div>
        <div id="wrapper">
            <div id="board-left">
                <div id="board-header">
                    <div id="header-left">
                        <img class="header-icon" id="ic-new" src="ic/noun_794825_cc.svg" />
                        <img class="header-icon" id="ic-open" src="ic/noun_1558235_cc.svg" />
                    </div>
                    <div id="hearder-right">
                        <p id="content-title">Untitled</p>
                        <img class="header-icon" id="ic-save" src="ic/noun_1692883_cc.svg" />
                    </div>
                </div>
                <div class="gray-line"></div>
                <div id="board-content">
                    <table class="tableIO">
                        <tr>
                            <td class="titleIO">Input</td>
                            <td class="textbox" id="input01"><div></div></td>
                        </tr>
                        <tr>
                            <td class="titleIO">Output</td>
                            <td class="textbox" id="output01"><div></div></td>
                        </tr>
                    </table>
                    <table class="tableIO">
                        <tr>
                            <td class="titleIO">Input</td>
                            <td class="textbox" id="input"><div></div></td>
                        </tr>
                        <tr>
                            <td class="titleIO">Output</td>
                            <td class="textbox" id="output"><div></div></td>
                        </tr>
                    </table>
                    <table class="tableIO">
                        <tr>
                            <td class="titleIO">Input</td>
                            <td class="textbox" id="input"><div></div></td>
                        </tr>
                        <tr>
                            <td class="titleIO">Output</td>
                            <td class="textbox" id="output"><div></div></td>
                        </tr>
                    </table>
                    <table class="tableIO">
                        <tr>
                            <td class="titleIO">Input</td>
                            <td class="textbox" id="input"><div></div></td>
                        </tr>
                        <tr>
                            <td class="titleIO">Output</td>
                            <td class="textbox" id="output"><div></div></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="calculator">
                <div class="cal-nametag">
                    <div class="nametag" id="tag-button">btn</div>
                    <div class="nametag" id="tag-pen">pen</div>
                </div>
                <div class="cal-body" id="cal-button">
                    <div id="cal-tag">
                        <span class="dropdown" id="nummode">CAL ▼</span>
                        <span class="dropdown" id="calmode">MODE ▼</span>
                        <div class="dropdown-content" id="nummode-dropdown">
                            <p>CAL</p>
                            <p>DEG</p>
                        </div>
                        <div class="dropdown-content" id="calmode-dropdown">
                            <p>None</p>
                            <p>Graph</p>
                            <p>Matrix</p>
                        </div>
                        <span class="dropdown" id="shift">SHIFT</span>
                    </div>
                    <table id="operation-buttons">
                        <tr>
                            <td class="button operation">=</td>
                            <td class="button operation"><</td>
                            <td class="button operation">></td>
                            <td class="button operation"><=</td>
                            <td class="button operation">>=</td>
                        </tr>
                        <tr>
                            <td class="button operation2">[</td>
                            <td class="button operation">x</td>
                            <td class="button operation">y</td>
                            <td class="button operation">z</td>
                            <td class="button operation2">]</td>
                        </tr>
                        <tr>
                            <td class="button operation2">(</td>
                            <td class="button operation">f</td>
                            <td class="button operation">g</td>
                            <td class="button operation">,</td>
                            <td class="button operation2">)</td>
                        </tr>
                        <tr>
                            <td class="button operation">i</td>
                            <td class="button operation">e</td>
                            <td class="button operation">pi</td>
                            <td class="button operation">==</td>
                            <td class="button operation">!=</td>
                        </tr>
                        <tr>
                            <td class="button operation">exp</td>
                            <td class="button operation">log</td>
                            <td class="button operation">sinh</td>
                            <td class="button operation">cosh</td>
                            <td class="button operation">tanh</td>
                        </tr>
                        <tr>
                            <td class="button operation">sqrt</td>
                            <td class="button operation">^</td>
                            <td class="button operation">sin</td>
                            <td class="button operation">cos</td>
                            <td class="button operation">tan</td>
                        </tr>
                        <tr>
                            <td class="button operation">abs</td>
                            <td class="button operation2">Matrix</td>
                            <td class="button operation">det</td>
                            <td class="button operation" id="del">ENTER</td>
                            <td class="button operation" id="ac">AC</td>
                        </tr>
                    </table>
                    <table id="number-buttons">
                        <tr>
                            <td class="button number">1</td>
                            <td class="button number">2</td>
                            <td class="button number">3</td>
                            <td class="button" id="plus">+</td>
                            <td class="button" id="minus">-</td>
                        </tr>
                        <tr>
                            <td class="button number">4</td>
                            <td class="button number">5</td>
                            <td class="button number">6</td>
                            <td class="button" id="multi">*</td>
                            <td class="button" id="divis">/</td>
                        </tr>
                        <tr>
                            <td class="button number">7</td>
                            <td class="button number">8</td>
                            <td class="button number">9</td>
                            <td class="button operation" colspan="2" rowspan="2" id="equal">EQUAL</td>
                        </tr>
                        <tr>
                            <td class="button operation" id="dot">.</td>
                            <td class="button number">0</td>
                            <td class="button number">00</td>
                        </tr>
                    </table>
                </div>
                <div class="cal-body" id="cal-pen">
                    <div id="pen-input">
                        <p>Input text</p>
                        <div id="textbox"></div>
                    </div>
                    <canvas id="pen-panel">
                    </canvas>
                    
                    <div id="pen-button">
                        <table>
                            <tr>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation" id="ac">AC</td>
                            </tr>
                            <tr>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation" rowspan="2" id="equal">EQUAL</td>
                            </tr>
                            <tr>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                                <td class="button operation"> </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer">
            광운대학교 휴먼컴퓨터인터페이스 과제 김현아 2014726041
        </div>
    </body>
</html>