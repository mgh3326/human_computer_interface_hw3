<html>
<head>
    <title>HCI 공학계산기 대화형 프로토타입</title>
    <style type="text/css">
        body {
			margin: 0px 0px 0px 0px;
			background-color: Gold;
        }

        h1 {
            font-family: "Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif;
            font-size: 30px;
            padding: 20px 10px;
            text-align: center;
            text-transform: uppercase;
            text-rendering: optimizeLegibility;
            color: #e0dfdc;
            background-color: #333;
            letter-spacing: .1em;
            text-shadow: 
            0 -1px 0 #fff, 
            0 1px 0 #2e2e2e, 
            0 2px 0 #2c2c2c, 
            0 3px 0 #2a2a2a, 
            0 4px 0 #282828, 
            0 5px 0 #262626, 
            0 6px 0 #242424, 
            0 7px 0 #222, 
            0 8px 0 #202020, 
            0 9px 0 #1e1e1e, 
            0 10px 0 #1c1c1c, 
            0 11px 0 #1a1a1a, 
            0 12px 0 #181818, 
            0 13px 0 #161616, 
            0 14px 0 #141414, 
            0 15px 0 #121212, 
            0 22px 30px rgba(0, 0, 0, 0.9);
        }
       
        #calculator {
            font-size: 0;
            width: 400px;
			height: 708px;
            background-color: #484848;
            padding: 20px;
            margin: auto;
            border-radius: 10px;           
        }
       
		#history {
            width: 385px;
            height: 325px;
			margin-top: 5px;
			margin-left: 3px;
            margin-bottom: 10px;
            padding: 0px 5px 0px 5px;
            background-color: snow;
            border-radius: 5px;
            
            <!--justify-content: flex-end;-->
            align-items: center;
            overflow: scroll;
            box-shadow: inset 0 0px 3px;
            font: 20px digital;
        }
		
		#how-to-use {
			width: 350px;
			height: 20px;
			margin-top: -15px;
			margin-left: 3px;
			padding: 0px 0px 0px 2px;
			position: relative; top: -32; left: 1;
			background-color: #F7BE81;
			vertical-align: middle;
			font: 12px digital;
			font-weight: bold;
			visibility: hidden;
		}
		
		#history-clear {
			width: 23px;
			margin-top: -19px;
			margin-left: 3px;
			position: relative; top: -41px; left: 353px;
			cursor: pointer;
		}
		
		#trashcan {
			width: 23px;
			height: 23px;
		}
	   
        #input {
            width: 385px;
            height: 45px;
			margin-left: 3px;
            margin-bottom: 15px;
            padding: 0px 5px 0px 5px;
            background-color: white;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
			overflow-y: hidden;
			overflow-x: scroll;
            box-shadow: inset 0 0px 3px;
            font: 20px digital;
        }
		#keypad {
			margin-left: 3px;
		}
		
        .key {
            width: 34.7px;
            height: 25px;
            background-color: WhiteSmoke;
            display: inline-flex;
            margin: 3px 4px 8px 1px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 5px 0px 5px 0px;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 3px 0 #a1a1a1, 0 2px 5px rgba(0, 0, 0, .75);
            font: bold 20px sans-serif;
        }

		.number-key {
            background-color: Gold;
        }
		
		.arithmetic-key {
            background-color: Crimson;
			color: white
        }
		
        .symbol-key {
            font: italic 20px "Times New Roman"
        }

        .function-key {
			background-color: #0066ff;
			color: white;
            font: italic 15px "Times New Roman"
        }
		
        .eval-key {
			margin-top: 5px;
			width: 392px;
            background-color: #4a9840;
            color: white;
        }
       
        .clear-key {
            background-color: Gray;
            color: white;
        }
		
		.delete-key {
            background-color: Gray;
            color: white;
        }
       
	    #history-clear:active {
            transform: translateY(2px);
        }
	   
        .key:active {
            background-color: #a1a1a1;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
        }
		
		::-webkit-scrollbar {width: 12px;}
		::-webkit-scrollbar-track {-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); border-radius: 10px;}
		::-webkit-scrollbar-thumb {border-radius: 10px; -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);}

    </style>
 
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js' type='text/javascript'></script>
    <script src='src/math.js' type='text/javascript'></script>

    <script type="text/javascript">
        $(document).ready(function(){
            var parser = math.parser();

            var valueData = '0';
			var coloredData = new Array();	// 색 변환 후의 문자열 저장
			
			$('#history-clear').click(function(e) {
				$('#history').text('');
			});
			
            $('.key').each(function(index, key){       
                $(this).click(function(e){
                    if(valueData == '0') valueData = '';

                    if($(this).text() == 'Enter')
                    {
                        try
                        {
                            valueData = parser.eval(valueData).toString();
                            var tokens = valueData.split(' ');
                            if(tokens[0] == 'function')
                            {
                                valueData = tokens[0];
                            }
                            $.each(coloredData, function(index, item) {
								$('#history').append(item);
							});
							$('#history').append('<br>' + '= ' + valueData.fontcolor("Dodgerblue") + '<br>' );								
							$('#history').scrollTop($('#history').get(0).scrollHeight);	// 스크롤이 항상 아래로 고정
							valueData = '0';
							coloredData = new Array();
							$('#input').text('');	// 모두 초기화
                        }
                        catch (e)
                        {
                            valueData = '0';
							coloredData = new Array();
							$('#input').text('');
                            if(valueData != 'function')
                            {
                                $('#history').append(e + '<br>');
                            }
                        }               
                    }
                    else
                    {
                        if($(this).text() == 'CL')
                        {
							if($('#how-to-use').css('visibility') == 'visible') {
								$('#how-to-use').css('visibility', 'hidden');
							}
                            valueData = '0';
							coloredData = new Array();
                            $('#input').text('');	// 모두 초기화
                        }
						else if($(this).text() == '←')
						{
							valueData = valueData.slice(0,-1);	// 마지막 데이터 삭제
							coloredData.pop();	// 배열의 마지막 삭제
							$('#input').text('');	// input 비워주고
							$.each(coloredData, function(index, item) {
								$('#input').append(item);
							});	// 배열의 나머지로 다시 채워줌
						}
                        else
                        {   
							// 누르는 버튼 별로 입력되는 글씨의 색을 바꿔줌
							// function-key: 빨, arithmetic-key+etc-key: 금, symbol-key: 초, parenthesis-key: 보
							if($(this).hasClass('function-key')) {
								coloredData.push($(this).text().fontcolor("red"));
								// 함수 버튼 누르면 사용법, 예시가 화면에 나타남
								switch ($(this).text()) {
								
								case 'sin': 
									$('#how-to-use').text('sin(x) -> 예) sin(10)=-0.54402111...');
									break;
								case 'cos':
									$('#how-to-use').text('cos(x) -> 예) cos(10)=-0.83907152...');
									break;	
								case 'tan':
									$('#how-to-use').text('tan(x) -> 예) tan(10)=0.64836082...');
									break;	
								case 'dot':
									$('#how-to-use').text('벡터내적 -> 예) x=[2,3] y=[3,2]일 때 dot(x,y)=12');
									break;	
								case 'cross':
									$('#how-to-use').text('벡터외적 -> 예) x=[1,2,3] y=[3,2,1]일 때 cross(x,y)=[-4,8,-4]');
									break;
								case 'det':
									$('#how-to-use').text('행렬식 -> 예) x=[1,2;3,4]일 때 det(x)=-2');
									break;	
								case 'inv':
									$('#how-to-use').text('역행렬 -> 예) x=[1,2;3,4]일 때 inv(x)=[[-2,1],[1.5,-0.5]]');
									break;	
								case 'exp':
									$('#how-to-use').text('exp(x) -> 예) x=1.3일 때 exp(1.3)=3.66929666');
									break;
								case 'log':
									$('#how-to-use').text('log(진수,밑) -> 예)log(4,2)=2 단, 밑 적지 않으면 밑은 자연상수' );
									break;	
								case 'sqrt':
									$('#how-to-use').text('sqrt(x) -> 예) x=9일 때 sqrt(9)=3');
									break;	
								}
								$('#how-to-use').css('visibility', 'visible');
							}
							else if($(this).hasClass('arithmetic-key') || $(this).hasClass('etc-key')) {
								coloredData.push($(this).text().fontcolor("Darkorange"));
							}
							else if($(this).hasClass('symbol-key')) {
								coloredData.push($(this).text().fontcolor("green"));
							}
							else if($(this).hasClass('parenthesis-key')) {
								coloredData.push($(this).text().fontcolor("MediumOrchid"));
							}
							else
							{
								coloredData.push($(this).text());
							}
							
							if($(this).hasClass('function-key')) {
								$('#input').append(coloredData.slice(-1).pop());
								coloredData.push('('.fontcolor("MediumOrchid"));
							}
							
							if(!$(this).hasClass('function-key') && $('#how-to-use').css('visibility') == 'visible') {
								$('#how-to-use').css('visibility', 'hidden');
							}
	
							$('#input').append(coloredData.slice(-1).pop());	// 배열의 마지막을 input에 넣어줌
							valueData = $('#input').text();	// input의 text를 그대로 valueData에 저장
                        }
                    }

                    e.preventDefault()
                })
            })
        })
    </script>
</head>
 
<body>
    <h1>
            Calculator (ver. 1.0)
    </h1>   
        
    <div id="calculator">
		<div id="history"></div>
		<div id="how-to-use">how to use functions?</div>
		<div id="history-clear"><img id="trashcan" src="src/Trashcan.png"></div>
        <div id="input"></div>
		<div id="keypad">
		<span class="key function-key">sin</span>
        <span class="key function-key">cos</span>
        <span class="key function-key">tan</span>
		<span class="key symbol-key">pi</span>
		<span class="key symbol-key">e</span>
		<span class="key etc-key">^</span>
		<span class="key etc-key">%</span>
        <span class="key clear-key">CL</span>
		<span class="key delete-key">←</span>
		<span class="key arithmetic-key">/</span>
		
		<span class="key function-key">dot</span>
		<span class="key function-key">cross</span>
        <span class="key function-key">det</span>
		<span class="key function-key">inv</span>
		<span class="key symbol-key">f</span>
        <span class="key symbol-key">g</span>
		<span class="key number-key">7</span>
        <span class="key number-key">8</span>
        <span class="key number-key">9</span>
		<span class="key arithmetic-key">*</span>
		
		<span class="key function-key">exp</span>
        <span class="key function-key">log</span>
        <span class="key function-key">sqrt</span>
		<span class="key symbol-key">x</span>
        <span class="key symbol-key">y</span>
        <span class="key symbol-key">z</span>
		<span class="key number-key">4</span>
        <span class="key number-key">5</span>
        <span class="key number-key">6</span>
		<span class="key arithmetic-key">-</span>
		
		<span class="key compare-key"><</span>
        <span class="key compare-key">></span>
		<span class="key parenthesis-key">(</span>
        <span class="key parenthesis-key">)</span>
		<span class="key parenthesis-key">[</span>
        <span class="key parenthesis-key">]</span>
        <span class="key number-key">1</span>
        <span class="key number-key">2</span>
        <span class="key number-key">3</span>
        <span class="key arithmetic-key">+</span>
		
		<span class="key compare-key"><=</span>
        <span class="key compare-key">>=</span>
        <span class="key compare-key">==</span>
        <span class="key compare-key">!=</span>
		<span class="key">:</span>
        <span class="key">;</span>
		<span class="key">,</span>
		<span class="key">.</span>
        <span class="key number-key">0</span>
        <span class="key arithmetic-key">=</span>
        <span class="key eval-key">Enter</span>
		</div>
    </div>
</body>
</html>