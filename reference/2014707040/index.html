<html>
<head>
    <title>Calculator</title>
    <style type="text/css">
        body {
            margin: 0px 0px 0px 0px;
        }
       
        #calculator {
            font-size: 0;
            width: 360px;
            height: 640px;
            background-color: #000000;
            padding: 0px;
            margin: auto;
        }
       
        #result {
            width: 353px;
            height: 143px;
            padding: 0px 0px 0px 6px;
            background-color: #000000;
            display: inline-flex;
            justify-content: flex-start;
            align-items: center;
            overflow-x: hidden;
            overflow-y: auto;
            word-break: break-word;
            white-space: pre-wrap;
            font: 18pt "Cambria Math";
            color: #ffffff;
            cursor: pointer;
        }

        #error {
            width: 10px;
            height: 10px;
            border-radius: 100px;
            position: relative;
            top: -10px;
            left: 316px;
        }

        .key {
            width: 68.5px;
            height: 58px;
            background-color: #404040;
            display: inline-flex;
            margin: 1.6px 1.3px 1.6px 2px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 1.6px 0px 1.6px 0px;
            cursor: pointer;
            font: 22pt "Consolas";
            color: #ffffff;
        }

        .side-key {
            width: 46px;
            height: 27px;
            font: 12pt "Consolas";
            margin: 1.6px 1px 1.6px 2px;
            background-color: #000000;
            border: 1px solid #505050;
        }
        .shift-key{
            width: 46px;
            height: 27px;
            background-color: #000000;
            display: inline-flex;
            margin: 1.6px 1px 1.6px 2px;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
            padding: 1.6px 0px 1.6px 0px;
            cursor: pointer;
            font: 13pt "Consolas";
            color: #ffffff;
            border: 1px solid #505050;
        }
        .function-key {
            background-color: #262626;
            font: 22pt "Cambria Math"
        }

        .oper-key {
            background-color: #D0D7F0;
            color: #000000;
        }
       
        .clear-key {
            background-color: #21306A;
            color: #ffffff;
        }
       
       #result:active {
            background: linear-gradient(to right, #000000, #202020, #404040, #a0a0a0a0 );
       }

        .key:hover {
            background-color: #ffffff;
            color: #404040;
        }
    </style>
 
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js' type='text/javascript'></script>
    <script src='lib/math.js' type='text/javascript'></script>

    <script type="text/javascript"> 
        function insert(str, index, value) {
            return str.substr(0, index) + value + str.substr(index);
        }
        $(document).ready(function(){
            var parser = math.parser();
            var history = '0';
            var inputValue = '0';
            var resultValue = '0';
            var cursor = 0;
            var toggle = false;
            $('#error').css('background-color','rgba(0,0,0,0)');
            $('#error').css('color','rgba(0,0,0,0)');
            $('#result').text(inputValue);
            $('#result').click(function(e){
                if(cursor > 0)
                    cursor--;
            });
            $('.shift-key').mouseup(function(e){
                if(!toggle)
                {
                    toggle = true;
                    $(this).css('background-color','#ffffff');
                    $(this).css('color','#404040');
                    $('#x').text('=');
                    $('#y').text('≠');
                    $('#z').text('<');
                    $('#f').text('≤');
                    $('#g').text('≥');
                    $('#assign').text('>');
                    $('#arc').text('det');
                    $('#e').text('exp');
                    $('#mul').text('cross'); $('#mul').css('font','17pt "Consolas"');
                    $('#div').text('mod'); $('#div').css('font','19pt "Consolas"');
                    $('#dot').text(',');
                    $('#parentheses').text('[]');
                    $('#deg').text(';');
                }
                else
                {
                    toggle = false;
                    $(this).css('background-color','#000000');
                    $(this).css('color','#ffffff');
                    $('#x').text('x');
                    $('#y').text('y');
                    $('#z').text('z');
                    $('#f').text('f(x)');
                    $('#g').text('g(x)');
                    $('#assign').text(':=');
                    $('#arc').text('arc');
                    $('#e').text('𝑒');
                    $('#mul').text('×'); $('#mul').css('font','22pt "Consolas"');
                    $('#div').text('÷'); $('#div').css('font','22pt "Consolas"');
                    $('#dot').text('.');
                    $('#parentheses').text('()');
                    $('#deg').text('°');
                }
            });
            $('.key').each(function(index, key){       
                $(this).mouseup(function(e){
                    if(inputValue == '0')
                        inputValue = '';
                    if(history == '0')
                        history = '';
                    if($(this).text() == 'EV')
                    {
                        try
                        {
                            resultValue = parser.eval(inputValue).toString();
                            var tokens = resultValue.split(' ');
                            if(tokens[0] == 'function')
                            {
                                resultValue = tokens[0];
                            }
                            history += inputValue + '\n= ' + resultValue + '\n-----------------------------------------\n';
                            $('#result').text(history);
                            cursor = 0;                        
                            inputValue = '0';
                        }
                        catch (e)
                        {
                            inputValue = '0';
                            if(inputValue != 'function')
                                $('#result').text(history + e);
                        }
                        $('#ac').text('AC');               
                    }
                    else if($(this).text() == 'AC')
                    {
                        inputValue = '0';
                        cursor = 0;
                        history = '';
                        $('#result').text(history);
                    }
                    else if($(this).text() == 'C')
                    {
                        inputValue = '0';
                        cursor = 0;
                        if(history == '')
                            history = '0';
                        $('#result').text(history);
                        $('#ac').text('AC');
                    }
                    else if($(this).text() == '←')
                    {
                        if(inputValue.length > 1)
                        {
                            if(inputValue[inputValue.length-1] == '(')
                            {
                                inputValue = inputValue.slice(0,-1);
                                cursor--;
                            }
                            else if(inputValue[inputValue.length-1] == '[')
                            {
                                inputValue = inputValue.slice(0,-1);
                                cursor--;
                            }
                            else if(inputValue[inputValue.length-1] == 'n'
                                || inputValue[inputValue.length-1] == 'g'
                                || inputValue[inputValue.length-1] == 'p')
                                inputValue = inputValue.slice(0,-3);
                            else if(inputValue[inputValue.length-1] == 't')
                            {
                                inputValue = inputValue.slice(0,-1);
                                if(inputValue[inputValue.length-1] == 'r')
                                    inputValue = inputValue.slice(0,-3);
                                else if(inputValue[inputValue.length-1] == 'e')
                                    inputValue = inputValue.slice(0,-2);
                            }
                            else if(inputValue[inputValue.length-1] == 's')
                            {
                                inputValue = inputValue.slice(0,-1);
                                if(inputValue[inputValue.length-1] == 'o')
                                    inputValue = inputValue.slice(0,-2);
                                else if(inputValue[inputValue.length-1] == 's')
                                    inputValue = inputValue.slice(0,-4);
                            }
                            else
                                inputValue = inputValue.slice(0,-1);
                            if(inputValue.length == 0)
                            {
                                inputValue = '0';
                                cursor = 0; 
                            }
                        }
                        else
                        {
                            inputValue = '0';
                            cursor = 0;
                        }
                        $('#result').text(history + inputValue);
                    }
                    else
                    {
                        switch($(this).text())
                        {
                            case 'f(x)':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'f()');
                                cursor++;
                                break;
                            case 'g(x)':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'g()');
                                cursor++;
                                break;
                            case ':=':
                                inputValue = insert(inputValue, inputValue.length - cursor, '=');
                                break;
                            case '=':
                                inputValue = insert(inputValue, inputValue.length - cursor, '==');
                                break;
                            case '≠':
                                inputValue = insert(inputValue, inputValue.length - cursor, '!=');
                                break;
                            case '≤':
                                inputValue = insert(inputValue, inputValue.length - cursor, '<=');
                                break;
                            case '≥':
                                inputValue = insert(inputValue, inputValue.length - cursor, '>=');
                                break;
                            case 'arc':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'a');
                                break;
                            case 'sin':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'sin()');
                                cursor++;
                                break;
                            case 'cos':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'cos()');
                                cursor++;
                                break;
                            case 'tan':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'tan()');
                                cursor++;
                                break;
                            case 'h':
                                if(cursor > 0)
                                    inputValue = insert(inputValue, inputValue.length - cursor - 1, 'h');
                                else
                                    inputValue = insert(inputValue, inputValue.length - cursor, 'h');
                                break;
                            case '𝑦/𝑥':
                                inputValue = insert(inputValue, inputValue.length - cursor, '(/)');
                                cursor += 2;
                                break;
                            case '𝑛!':
                                inputValue = insert(inputValue, inputValue.length - cursor, '!');
                                break;
                            case '𝑥^2':
                                inputValue = insert(inputValue, inputValue.length - cursor, '^2');
                                break;
                            case '𝑥^𝑦':
                                inputValue = insert(inputValue, inputValue.length - cursor, '^()');
                                cursor++;
                                break;
                            case '√𝑥':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'sqrt()');
                                cursor++;
                                break;
                            case 'π':
                                inputValue = insert(inputValue, inputValue.length - cursor, '(pi)');
                                break;
                            case '𝑖':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'i');
                                break;
                            case '𝑒':
                                inputValue = insert(inputValue, inputValue.length - cursor, '(e)');
                                break;
                            case 'log':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'log(,)');
                                cursor += 2;
                                break;
                            case 'ln':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'log(e,)');
                                cursor++;
                                break;
                            case '()':
                                inputValue = insert(inputValue, inputValue.length - cursor, '()');
                                cursor++;
                                break;
                            case '°':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'deg');
                                break;
                            case '+':
                                if(inputValue == '')
                                {
                                    inputValue += resultValue + '+';
                                    break;
                                }
                                inputValue = insert(inputValue, inputValue.length - cursor, '+');
                                break;
                            case '-':
                                if(inputValue == '')
                                {
                                    inputValue += resultValue + '-';
                                    break;
                                }
                                inputValue = insert(inputValue, inputValue.length - cursor, '-');
                                break;
                            case '×':
                                if(inputValue == '')
                                {
                                    inputValue += resultValue + '*';
                                    break;
                                }
                                inputValue = insert(inputValue, inputValue.length - cursor, '*');
                                break;
                            case '÷':
                                if(inputValue == '')
                                {
                                    inputValue += resultValue + '/';
                                    break;
                                }
                                inputValue = insert(inputValue, inputValue.length - cursor, '/');
                                break;
                            case 'det':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'det()');
                                cursor++;
                                break;
                            case 'exp':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'exp()');
                                cursor++;
                                break;
                            case 'cross':
                                inputValue = insert(inputValue, inputValue.length - cursor, 'cross([],[])');
                                cursor += 5;
                                break;
                            case 'mod':
                                inputValue = insert(inputValue, inputValue.length - cursor, '%');
                                break;
                            case '[]':
                                inputValue = insert(inputValue, inputValue.length - cursor, '[]');
                                cursor++;
                                break;
                            default:
                                inputValue = insert(inputValue, inputValue.length - cursor, $(this).text());
                                break;
                        }
                        $('#result').text(history + inputValue);
                        if(inputValue != '')
                            $('#ac').text('C');
                    }
                    $('#result').scrollTop($('#result').prop('scrollHeight'));
                    try
                    {
                        parser.eval(inputValue).toString();
                        $('#error').css('background-color','rgba(0,0,0,0)');
                    }
                    catch (e)
                    {
                        $('#error').css('background-color','rgba(195,38,12,0.7)');
                    }  
                    e.preventDefault()                  
                })   
            })
        })
    </script>
</head>
 
<body>
     
    <div id="calculator">
        <div id="result"></div>
        <div id="error"></div>
        <span class="key side-key", id="x">x</span>
        <span class="key side-key", id="y">y</span>
        <span class="key side-key", id="z">z</span>
        <span class="key side-key", id="f">f(x)</span>
        <span class="key side-key", id="g">g(x)</span>
        <span class="key side-key", id="assign">:=</span>
        <span class="shift-key">↑</span>
        <span class="key function-key", id="arc">arc</span>
        <span class="key function-key">sin</span>
        <span class="key function-key">cos</span>
        <span class="key function-key">tan</span>
        <span class="key function-key">h</span>
        <span class="key function-key">𝑦/𝑥</span>
        <span class="key function-key">𝑛!</span>
        <span class="key function-key">𝑥^2</span>
        <span class="key function-key">𝑥^𝑦</span>
        <span class="key function-key">√𝑥</span>
        <span class="key function-key">π</span>
        <span class="key function-key">𝑖</span>
        <span class="key function-key", id="e">𝑒</span>
        <span class="key function-key">log</span>
        <span class="key function-key">ln</span>
        <span class="key">7</span>
        <span class="key">8</span>
        <span class="key">9</span>
        <span class="key clear-key">←</span>
        <span class="key clear-key", id="ac">AC</span>
        <span class="key">4</span>
        <span class="key">5</span>
        <span class="key">6</span>
        <span class="key oper-key", id="mul">×</span>
        <span class="key oper-key", id="div">÷</span>
        <span class="key">1</span>
        <span class="key">2</span>
        <span class="key">3</span>
        <span class="key oper-key">+</span>
        <span class="key oper-key">-</span>
        <span class="key">0</span>
        <span class="key", id="dot">.</span>
        <span class="key", id="parentheses">()</span>
        <span class="key", id="deg">°</span>
        <span class="key oper-key">EV</span>
    </div>
</body>
</html>